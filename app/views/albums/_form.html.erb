<div class="card border-0 rounded-0" style="box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
  
  <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center py-3 px-4 border-0 rounded-0">
    <h5 class="mb-0 fw-semibold">
      <i class="bi bi-disc me-2"></i>
      <%= album.persisted? ? "Edit Album" : "New Album" %>
    </h5>
    <%= link_to albums_path, class: "btn btn-outline-light btn-sm border d-flex align-items-center" do %>
      <i class="bi bi-arrow-left me-2"></i> Back to Albums
    <% end %>
  </div>

  <div class="card-body bg-white p-4">
    <%= form_with(model: album, local: true, html: { multipart: true }, class: "album-form") do |form| %>
      
      <% if album.errors.any? %>
        <div class="alert alert-danger alert-dismissible fade show rounded-0 border-0 mb-4" 
             style="background-color: #fdf0f0; color: #8b2a2a; border-left: 4px solid #dc3545;" role="alert">
          <div class="d-flex align-items-center mb-2">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <h6 class="mb-0 fw-semibold">
              <%= pluralize(album.errors.count, "error") %> prohibited this album from being saved:
            </h6>
          </div>
          <ul class="mb-0 ps-3" style="font-size: 0.9rem;">
            <% album.errors.each do |error| %>
              <li><%= error.full_message %></li>
            <% end %>
          </ul>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <div class="mb-4">
        <%= form.label :title, "Album Title", class: "form-label fw-medium text-dark mb-2" %>
        <%= form.text_field :title, class: "form-control rounded-0 border", placeholder: "Enter album title" %>
      </div>

      <div class="mb-4">
        <%= form.label :release_year, "Release Year", class: "form-label fw-medium text-dark mb-2" %>
        <%= form.number_field :release_year, class: "form-control rounded-0 border", 
            min: 1900, max: Time.current.year, placeholder: "e.g. 1990" %>
      </div>

      <div class="mb-4">
        <%= form.label :tracklist, "Tracklist", class: "form-label fw-medium text-dark mb-2" %>
        <%= form.text_area :tracklist, class: "form-control rounded-0 border", rows: 4, 
            placeholder: "Enter tracklist (one track per line)" %>
        <div class="form-text text-muted small mt-1">
          Enter one track per line
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-4 mb-3">
          <%= form.label :band_ids, "Bands", class: "form-label fw-medium text-dark mb-2" %>
          <%= form.collection_select :band_ids, Band.order(:name), :id, :name, 
              { prompt: "Select bands" }, { multiple: true, class: "form-select rounded-0 border", style: "height: 120px;" } %>
          <div class="form-text text-muted small mt-1">
            Hold Ctrl/Cmd to select multiple bands
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <%= form.label :genre_ids, "Genres", class: "form-label fw-medium text-dark mb-2" %>
          <%= form.collection_select :genre_ids, Genre.order(:name), :id, :name, 
              { prompt: "Select genres" }, { multiple: true, class: "form-select rounded-0 border", style: "height: 120px;" } %>
          <div class="form-text text-muted small mt-1">
            Hold Ctrl/Cmd to select multiple genres
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <%= form.label :style_ids, "Styles", class: "form-label fw-medium text-dark mb-2" %>
          <%= form.collection_select :style_ids, Style.order(:name), :id, :name, 
              { prompt: "Select styles" }, { multiple: true, class: "form-select rounded-0 border", style: "height: 120px;" } %>
          <div class="form-text text-muted small mt-1">
            Hold Ctrl/Cmd to select multiple styles
          </div>
        </div>
      </div>

      <div class="mb-4">
        <%= form.label :cover, "Album Cover", class: "form-label fw-medium text-dark mb-2" %>
        <%= form.file_field :cover, class: "form-control rounded-0 border" %>
        
        <% if album.cover.attached? %>
          <div class="mt-3">
            <p class="text-muted small mb-2">Current Cover:</p>
            <%= image_tag url_for(album.cover), class: "rounded-0 border", style: "max-width: 150px;" %>
          </div>
        <% else %>
          <div class="form-text text-muted small mt-1">
            Optional: Upload album cover art (JPG, PNG, GIF)
          </div>
        <% end %>
      </div>

      <div class="d-flex justify-content-between align-items-center pt-3 border-top" style="border-color: #e0e0e0 !important;">
        <div class="text-muted small">
          <i class="bi bi-info-circle me-1"></i>
          <%= album.persisted? ? "Update album information" : "Create new album entry" %>
        </div>
        <div class="d-flex gap-2">
          <%= link_to albums_path, class: "btn btn-outline-secondary rounded-0 border px-4 d-flex align-items-center" do %>
            <i class="bi bi-x-circle me-2"></i>Cancel
          <% end %>
          <%= form.submit (album.persisted? ? "Update Album" : "Create Album"), 
              class: "btn btn-dark rounded-0 border-0 px-4 d-flex align-items-center" %>
        </div>
      </div>

    <% end %>
  </div>

  <div class="card-footer bg-light text-muted small py-3 px-4 border-0 border-top" style="border-color: #e0e0e0 !important;">
    <div class="text-center">
      <i class="bi bi-disc me-1"></i> Album Management
    </div>
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('.album-form');
  
  if (form) {
    const inputs = form.querySelectorAll('.form-control, .form-select');
    
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        this.style.borderColor = '#333';
        this.style.boxShadow = '0 0 0 2px rgba(51, 51, 51, 0.1)';
      });
      
      input.addEventListener('blur', function() {
        this.style.boxShadow = 'none';
        if (!this.value && this.hasAttribute('required')) {
          this.style.borderColor = '#e0e0e0';
        }
      });
    });

    const requiredFields = form.querySelectorAll('[required]');
    
    requiredFields.forEach(field => {
      field.addEventListener('input', function() {
        if (!this.value.trim()) {
          this.classList.add('is-invalid');
          this.classList.remove('is-valid');
        } else {
          this.classList.remove('is-invalid');
          this.classList.add('is-valid');
        }
      });

      if (!field.value.trim() && field.hasAttribute('required')) {
        field.classList.add('is-invalid');
      } else if (field.value.trim()) {
        field.classList.add('is-valid');
      }
    });
  }
});
</script>